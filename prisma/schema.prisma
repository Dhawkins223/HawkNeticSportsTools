// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = env("DB_PROVIDER")
  url      = env("DATABASE_URL")
}

model Team {
  id        Int       @id @default(autoincrement())
  name      String
  abbr      String    @unique
  players   Player[]
  homeGames Game[]    @relation("HomeTeam")
  awayGames Game[]    @relation("AwayTeam")
  injuries  Injury[]
}

model Player {
  id         Int               @id @default(autoincrement())
  name       String
  externalId String?           @unique
  team       Team              @relation(fields: [teamId], references: [id])
  teamId     Int
  stats      PlayerGameStats[]
  baselines  PlayerBaseline[]
  injuries   Injury[]
  props      PropOdds[]
}

model Game {
  id         Int               @id @default(autoincrement())
  externalId String            @unique
  date       DateTime
  venue      String?
  status     String
  homeTeam   Team              @relation("HomeTeam", fields: [homeTeamId], references: [id])
  homeTeamId Int
  awayTeam   Team              @relation("AwayTeam", fields: [awayTeamId], references: [id])
  awayTeamId Int
  odds       GameOdds[]
  props      PropOdds[]
  stats      PlayerGameStats[]
}

model GameOdds {
  id             Int      @id @default(autoincrement())
  game           Game     @relation(fields: [gameId], references: [id])
  gameId         Int
  bookmaker      String
  spreadHome     Float?
  spreadAway     Float?
  spreadHomeOdds Int?
  spreadAwayOdds Int?
  total          Float?
  overOdds       Int?
  underOdds      Int?
  mlHome         Int?
  mlAway         Int?
  createdAt      DateTime @default(now())

  @@index([gameId, bookmaker, createdAt])
}

model PropOdds {
  id        Int      @id @default(autoincrement())
  game      Game     @relation(fields: [gameId], references: [id])
  gameId    Int
  player    Player   @relation(fields: [playerId], references: [id])
  playerId  Int
  market    String
  line      Float
  overOdds  Int
  underOdds Int
  source    String
  updatedAt DateTime @default(now())

  @@unique([gameId, playerId, market, source])
  @@index([playerId, market])
}

model PlayerGameStats {
  id        Int      @id @default(autoincrement())
  game      Game     @relation(fields: [gameId], references: [id])
  gameId    Int
  player    Player   @relation(fields: [playerId], references: [id])
  playerId  Int
  minutes   Float
  points    Float
  rebounds  Float
  assists   Float
  threes    Float
  createdAt DateTime @default(now())

  @@unique([gameId, playerId])
  @@index([playerId])
}

model Injury {
  id        Int      @id @default(autoincrement())
  player    Player   @relation(fields: [playerId], references: [id])
  playerId  Int
  team      Team     @relation(fields: [teamId], references: [id])
  teamId    Int
  status    String
  note      String?
  updatedAt DateTime @default(now())

  @@unique([playerId])
  @@index([teamId])
}

model PlayerBaseline {
  id        Int      @id @default(autoincrement())
  player    Player   @relation(fields: [playerId], references: [id])
  playerId  Int
  market    String
  mean      Float
  stdev     Float
  minutes   Float
  usageRate Float
  updatedAt DateTime @default(now())

  @@unique([playerId, market])
}
